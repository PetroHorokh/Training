@using Rent.DTOs.Library

@Html.Label("assetGrid", "Asset control")

@(Html.DevExtreme().DataGrid<AssetToGetDto>()
    .ID("assetGrid")
    .Width(500)
    .RenderAsync(true)
    .DataSource(ds => ds.Mvc()
        .Controller("Asset")
        .LoadAction("Get")
        .InsertAction("Post")
        .DeleteAction("Delete")
        .Key("AssetId")
        .OnBeforeSend("grid_dataSource_beforeSend")
    )
    .RemoteOperations(true)
    .RepaintChangesOnly(true)
    .Columns(columns =>
    {
        columns.AddFor(m => m.RoomId)
            .Width(200)
            .Caption("Room")
            .Lookup(lookup => lookup.DataSource(ds => ds.WebApi()
                    .Controller("Asset")
                    .LoadAction("RoomLookup")
                    .Key("Value")
                    .OnBeforeSend("grid_dataSource_beforeSend"))
                .ValueExpr("Value")
                .DisplayExpr("Text")
        );

        columns.AddFor(m => m.OwnerId)
            .Width(150)
            .Caption("Owner")
            .Lookup(lookup => lookup.DataSource(ds => ds.WebApi()
                    .Controller("Asset")
                    .LoadAction("OwnerLookup")
                    .Key("Value")
                    .OnBeforeSend("grid_dataSource_beforeSend"))
                .ValueExpr("Value")
                .DisplayExpr("Text")
        );
    })
    .Editing(editing =>
    {
        editing.Mode(GridEditMode.Popup);
        editing.AllowAdding(true);
        editing.AllowDeleting(true);
        editing.Popup(p => p
            .Width(500)
            .Height(200)
            );
        editing.Form(f => f
            .ColCount(1)
            .Items(items =>
        {
            items.AddSimpleFor(m => m.OwnerId)
                .Label(l => l.Text("Owner"))
                .Editor(w => w.Lookup());

            items.AddSimpleFor(m => m.RoomId)
                .Label(l => l.Text("Room"))
                .Editor(w => w.Lookup());
        }));
    })
    .ShowBorders(true)
    .Scrolling(scrolling => scrolling.RowRenderingMode(GridRowRenderingMode.Virtual))
    .Paging(paging => paging.PageSize(5))
    .Pager(pager =>
    {
        pager.Visible(true);
        pager.DisplayMode(GridPagerDisplayMode.Full);
        pager.ShowPageSizeSelector(true);
        pager.AllowedPageSizes(new JS("[5, 7, 10]"));
        pager.ShowNavigationButtons(true);
    })
    .SearchPanel(sp =>
    {
        sp.Visible(true);
        sp.HighlightSearchText(false);
    })
    .FilterRow(r => r.Visible(true))
    .Toolbar(toolbar =>
    {
        toolbar.Items(items =>
        {
            items.Add()
                .Location(ToolbarItemLocation.Before)
                .Widget(w => w.Button()
                    .Icon("refresh")
                    .OnClick(@<text>function () {$("#roomGrid").dxDataGrid("getDataSource").reload();}</text>));

            items.Add().Name("addRowButton");
            items.Add().Name("searchPanel");
        });
    })
)